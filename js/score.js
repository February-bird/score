import{findOneByIndex,STORE_NAME_1}from"./db/db.js";import{getSearchParams}from"./tools/url.js";import{addClass,removeClass,setTextContent}from"./tools/dom.js";let id=getSearchParams(location.href,"id"),stuName=getSearchParams(location.href,"name"),{subjects,overallRank}=await findOneByIndex(STORE_NAME_1,"stuNo",id),doc=document,template=doc.querySelector("#template").content,tds=template.querySelectorAll("td"),fragment=doc.createDocumentFragment(),noPassCount=(setTextContent(".stu-id",id),setTextContent(".stu-name",stuName),setTextContent(".overall-rank",overallRank),0),passImg=(subjects?.forEach(({course:e,score:t,comment:a})=>{initValue(tds[0],e),initValue(tds[1],t,"SCORE"),initValue(tds[2],a,"COMMENT");e=doc.importNode(template,!0);fragment.append(e),t<60&&noPassCount++}),doc.querySelector(".pass-img")),table=doc.querySelector("table");function initValue(e,t,a=""){e.textContent=t,("SCORE"==a&&t<60||"COMMENT"==a&&"补考"==t?addClass:removeClass)(e,"not-pass")}noPassCount?passImg.src="img/nopass.svg":passImg.src=overallRank<7?"img/good.svg":"img/pass.svg",table.tBodies[0].append(fragment),passImg.addEventListener("load",()=>{var e=doc.querySelector(".loading");addClass(table,"show"),addClass(e,"hide")});